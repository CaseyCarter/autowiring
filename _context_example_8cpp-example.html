<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Autowiring: ContextExample.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Autowiring
   &#160;<span id="projectnumber">0.6.0</span>
   </div>
   <div id="projectbrief">A C++ Inversion of Control Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="pages.html"><span>Developer's&#160;Guide</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_context_example_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ContextExample.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">// Copyright (C) 2012-2015 Leap Motion, Inc. All rights reserved.</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_autowired_8h.html">autowiring/Autowired.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// pretty print boolean with desciption</span></div>
<div class="line"><span class="preprocessor">#define check(desc,val) std::cout &lt;&lt; desc &lt;&lt; (val ? &quot;: True&quot; : &quot;: False&quot;) &lt;&lt; std::endl</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// dummy classes</span></div>
<div class="line"><span class="keyword">class </span>Foo {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">int</span> x;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Bar{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <a name="_a0"></a><a class="code" href="class_autowired.html">Autowired&lt;Foo&gt;</a> foo;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <span class="comment">//                       //</span></div>
<div class="line">  <span class="comment">//   GlobalCoreContext   //</span></div>
<div class="line">  <span class="comment">//                       //</span></div>
<div class="line"><span class="comment"></span>  { </div>
<div class="line">    <span class="comment">// The CoreContext is the basic unit of organization in Autowriring. They are organized</span></div>
<div class="line">    <span class="comment">// in a tree structure, the root of which is the GlobalCoreContext. Each thread</span></div>
<div class="line">    <span class="comment">// keeps track of its current context, which defaults to GlobalCoreContext</span></div>
<div class="line">  </div>
<div class="line">    <span class="comment">// This creates a shared_ptr to the global context</span></div>
<div class="line">    <a name="_a1"></a><a class="code" href="class_auto_global_context.html">AutoGlobalContext</a> global;</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// This is the a shared_ptr to the current context</span></div>
<div class="line">    <a name="_a2"></a><a class="code" href="class_auto_current_context.html">AutoCurrentContext</a> ctxt;</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// Since we default to the current context, they should be the same</span></div>
<div class="line">    check(<span class="stringliteral">&quot;Current context is global&quot;</span>, global==ctxt);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//                                             //</span></div>
<div class="line">  <span class="comment">//   Context Creation and Switching Contexts   //</span></div>
<div class="line">  <span class="comment">//                                             //</span></div>
<div class="line"><span class="comment"></span>  {</div>
<div class="line">    <span class="comment">// New contexts can be created using the &#39;Create&#39; factory method on a context.</span></div>
<div class="line">    <span class="comment">// The factory will create a child context to &#39;this&#39; context.</span></div>
<div class="line">    <span class="comment">// A helper type &#39;AutoCreateContext&#39; will call Create on the current context</span></div>
<div class="line">    <span class="comment">// automatically</span></div>
<div class="line">    </div>
<div class="line">    <a class="code" href="class_auto_global_context.html">AutoGlobalContext</a> global; <span class="comment">//same as AutoCurrentContext here</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create&#39;s a chile of the current context</span></div>
<div class="line">    <a name="_a3"></a><a class="code" href="class_auto_create_context_t.html">AutoCreateContext</a> childCtxt; <span class="comment">// Same as childCtxt = AutoCurrentContext()-&gt;Create&lt;void&gt;();</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Even though we&#39;ve created a child context, we&#39;re still in the global context</span></div>
<div class="line">    check(<span class="stringliteral">&quot;Are we in the GlobalCoreContext&quot;</span>, <a class="code" href="class_auto_current_context.html">AutoCurrentContext</a>()-&gt;IsGlobalContext());</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// CurrentContextPusher can be used to switch contexts using RAII patterns</span></div>
<div class="line">    {</div>
<div class="line">      <a name="_a4"></a><a class="code" href="class_current_context_pusher.html">CurrentContextPusher</a> pshr(childCtxt);</div>
<div class="line">      check(<span class="stringliteral">&quot;Now in child context&quot;</span>, <a class="code" href="class_auto_current_context.html">AutoCurrentContext</a>() == childCtxt);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// Back in global context</span></div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">//                                                   //</span></div>
<div class="line">  <span class="comment">//   Adding members to a context with AutoRequired   //</span></div>
<div class="line">  <span class="comment">//                                                   //</span></div>
<div class="line"><span class="comment"></span>  {</div>
<div class="line">    <span class="comment">// Switch to a child context</span></div>
<div class="line">    <a class="code" href="class_auto_create_context_t.html">AutoCreateContext</a> ctxt;</div>
<div class="line">    <a class="code" href="class_current_context_pusher.html">CurrentContextPusher</a> pshr(ctxt);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// A single instance of any type can be injected into a context</span></div>
<div class="line">    <span class="comment">// This is done using AutoRequied</span></div>
<div class="line">    <a name="_a5"></a><a class="code" href="class_auto_required.html">AutoRequired&lt;Foo&gt;</a> foo; <span class="comment">// We now have a std::shared_ptr&lt;Foo&gt;</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// AutoRequired will return an instance of the requested type from</span></div>
<div class="line">    <span class="comment">// the current context. If that type doesn&#39;t exist in the current</span></div>
<div class="line">    <span class="comment">// context, it will create an instace</span></div>
<div class="line">    foo-&gt;x = 5;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// If we try to AutoRequire a second Foo, we&#39;ll get a pointer to</span></div>
<div class="line">    <span class="comment">// the same instance</span></div>
<div class="line">    <a class="code" href="class_auto_required.html">AutoRequired&lt;Foo&gt;</a> foo2;</div>
<div class="line">    check(<span class="stringliteral">&quot;foo2 is the same instance as foo&quot;</span>, foo==foo2);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;foo2 value of &#39;x&#39;: &quot;</span> &lt;&lt; foo2-&gt;x &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">  } <span class="comment">// &#39;ctxt&#39; and all members a destroyed when the context goes out of scope</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">//                  //</span></div>
<div class="line">  <span class="comment">//     Autowired    //</span></div>
<div class="line">  <span class="comment">//                  //</span></div>
<div class="line"><span class="comment"></span>  {</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="class_auto_create_context_t.html">AutoCreateContext</a> ctxt;</div>
<div class="line">      <a class="code" href="class_current_context_pusher.html">CurrentContextPusher</a> pshr(ctxt);</div>
<div class="line">    </div>
<div class="line">      <span class="comment">// Autowired is similar to AutoRequied, except it doesn&#39;t create the</span></div>
<div class="line">      <span class="comment">// object if it doesn&#39;t already exist. It also searches up the tree</span></div>
<div class="line">      <span class="comment">// if the object isn&#39;t found in the current context</span></div>
<div class="line">      <a class="code" href="class_autowired.html">Autowired&lt;Foo&gt;</a> foo;</div>
<div class="line">      check(<span class="stringliteral">&quot;foo is an empty pointer&quot;</span>, !foo);</div>
<div class="line">    </div>
<div class="line">      <span class="comment">// If we inject to type Foo later, foo will automatically point to that instance</span></div>
<div class="line">      <a class="code" href="class_auto_required.html">AutoRequired&lt;Foo&gt;</a>();</div>
<div class="line">      check(<span class="stringliteral">&quot;foo now contains an instance of Foo&quot;</span>, foo);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// This delayed satisfaction also works for class members.</span></div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="class_auto_create_context_t.html">AutoCreateContext</a> ctxt;</div>
<div class="line">      <a class="code" href="class_current_context_pusher.html">CurrentContextPusher</a> pshr(ctxt);</div>
<div class="line">      </div>
<div class="line">      <span class="comment">// Bar has an Autowrired&lt;Foo&gt; classmember</span></div>
<div class="line">      <a class="code" href="class_auto_required.html">AutoRequired&lt;Bar&gt;</a> bar;</div>
<div class="line">      </div>
<div class="line">      check(<span class="stringliteral">&quot;Foo member of bar is satisfied before AutoRequired&quot;</span>, bar-&gt;foo);</div>
<div class="line">      </div>
<div class="line">      <span class="comment">// If we inject Foo into the context, the Autowired&lt;Foo&gt; member of Bar will be satisfied</span></div>
<div class="line">      <a class="code" href="class_auto_required.html">AutoRequired&lt;Foo&gt;</a>();</div>
<div class="line">      check(<span class="stringliteral">&quot;Foo member of bar is satisfied after AutoRequired&quot;</span>, bar-&gt;foo);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Jun 15 2015 11:10:29 for Autowiring by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
